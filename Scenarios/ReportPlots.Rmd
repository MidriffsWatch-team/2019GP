---
title: "Report Pots"
author: "Seleni Cruz"
date: "February 13, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE, message=FALSE}
library(ggplot2)
library(here)
library(plotly)
library(tidyverse)
library(gganimate)
library(ggrepel)
library(ggridges)
library(ggpubr)
library(gridExtra)
library(grid)
```

#importing the dataset only looking at 2015-2050
```{r}
res<-read.csv(here::here("Scenarios", "PatchModel_size.csv"))%>%
  filter(Year <= 2050 & Adjusted== "MT")
bmsy<- expression(paste(B/B[MSY]))
fmsy <- expression(paste(F/F[MSY]))

```

1. Kobe of Initial Status 
```{r}
initial <- res%>%
  filter(Year == 2015 & Status == 0 & Total_Area=="5%")%>%
  mutate(Status = "initial")

initial <- ggplot(initial, aes(x= bbmsy, y=ffmsy, size=Catch_est))+
  geom_rect(xmin = 0.0, xmax = 1.0, ymin = 0.0, ymax = 1, fill = 'yellow', alpha = 0.1) +
  geom_rect(xmin = 0, xmax = 1, ymin = 1.0, ymax = 2.1, fill = 'red', alpha = 0.1) +
  geom_rect(xmin = 1, xmax = 1.5, ymin = 0, ymax = 1, fill = 'green', alpha = 0.1) +
  geom_rect(xmin = 1, xmax = 2.1, ymin = 1, ymax = 2.1, fill = 'orange', alpha = 0.1)+
  geom_point()+
  scale_size(range = c(3, 10))+
  labs(x=bmsy, y=fmsy, title = "Initial Fisheries Status: 2015")+
  geom_vline(xintercept = 1, linetype="dotted", color="black") +
  geom_hline(yintercept = 1, linetype="dotted", color="black") +
  theme_classic(base_size = 18)
initial
ggsave("initial.jpg", width=8, height=5, dpi=300)
```


#2. Kobe plot in Open Access B/Bmsy 0.3 and various implementtion dates 
```{r}
initial <- res%>%
  filter(Year == 2015 & Status == 0)%>%
  mutate(Status = "initial")

plot<-res%>%
  filter(Year== 2050 & Total_Area == "5%")%>%
  rbind(initial)

plot$Status<- as.factor(plot$Status)

KobeOA <- ggplot(plot, aes(x= bbmsy, y=ffmsy, group=Name))+
  geom_point(size=3, aes(color= Status, shape=Status))+
  #scale_shape_manual(values=c(16, 17, ))+
  labs(title= "Fishery Status 2050", x=bmsy, y=fmsy)+
  geom_vline(xintercept = 1, linetype="dotted", color="black") +
  geom_hline(yintercept = 1, linetype="dotted", color="black") +
  theme_classic(base_size = 20)
KobeOA
ggsave("KobeOA.jpg", width=8, height=5, dpi=300)

OA <-res%>%
  filter(Status=="2015")
OA$Status<- as.factor(OA$Status)
OA$Name<- as.factor(OA$Name)

KobeOA_size<-ggplot(OA, aes(x= bbmsy, y=ffmsy, group=Name))+
  geom_point(size=2, aes(color=Year, shape=Total_Area))+
  #scale_shape_manual(values=c(16, 17))+
  labs(title= "Fishery Status at various MPA Sizes", subtitle = "2015-2050", x=bmsy, y=fmsy)+
  geom_vline(xintercept = 1, linetype="dotted", color="black") +
  geom_hline(yintercept = 1, linetype="dotted", color="black") +
  theme_classic(base_size = 18)

KobeOA_size<- KobeOA_size+
   facet_wrap(~ Name, ncol=4)
KobeOA_size
ggsave("KobeOA_byMRSize.jpg", width=20, height=15, dpi=300)

```

#FMSY Kobe Plot

```{r}
fmsy<- read.csv(here::here("Scenarios", "PatchModel_FMSY.csv"))%>%
  filter(Adjusted=="MT")

initial <- res%>%
  filter(Year == 2015 & Status == 0 & Total_Area=="5%")%>%
  mutate(Status = "initial")

plot<-fmsy%>%
  filter(Year== 2050 & Total_Area == "5%")%>%
  rbind(initial)

FMSY<-ggplot(plot, aes(x= bbmsy, y=ffmsy, group=Name))+
  geom_point(size=3, aes(shape=Status, color=Status))+
  #scale_shape_manual(values=c(16, 17))+
  labs(title= "Fishery Status when F=Fmsy", subtitle = "2015-2050: 5% Total Area", x=bmsy, y=fmsy)+
  geom_vline(xintercept = 1, linetype="dotted", color="black") +
  geom_hline(yintercept = 1, linetype="dotted", color="black") +
  theme_classic(base_size = 18)
FMSY
ggsave("KobeFMSY.jpg", width=8, height=5, dpi=300)
FMSY<- FMSY+
   facet_wrap(~ Name, ncol=3)
FMSY
ggsave("KobeFMSY_byGenus.jpg", width=10, height=12, dpi=300)
```

#Kobe plot with implementation dates and different reserve sizes 
```{r}
plot<-res%>%
  filter(Year== 2050)%>%
  rbind(initial)

kobe2<- ggplot(plot, aes(x= bbmsy, y=ffmsy, group= Name))+
  geom_point(size=3, aes(color=Name, shape = Status))+
  #scale_shape_manual(values=c(16, 17, ))+
  labs(title= "Fishery Status with Reserve Implementation", x=bmsy, y=fmsy)+
  geom_vline(xintercept = 1, linetype="dotted", color="black") +
  geom_hline(yintercept = 1, linetype="dotted", color="black") +
  theme_classic(base_size = 18)
kobe2<- kobe2 +
    facet_wrap(~ Total_Area, ncol=2)
kobe2

ggsave("Kobe2.jpg", width=10, height=12, dpi=300)

kobe3<- ggplot(plot, aes(x= bbmsy, y=ffmsy, group= Name))+
  geom_point(size=3, aes(color=Name, shape = Total_Area))+
  #scale_shape_manual(values=c(16, 17, ))+
  labs(title= "Fishery Status with Reserve Implementation" , x=bmsy, y=fmsy)+
  geom_vline(xintercept = 1, linetype="dotted", color="black") +
  geom_hline(yintercept = 1, linetype="dotted", color="black") +
  theme_classic(base_size = 18)
kobe3<- kobe3 +
    facet_wrap(~ Status, ncol=2)
kobe3

ggsave("Kobe3.jpg", width=10, height=12, dpi=300)


```

#Some fun line graphs 
```{r}
res<-read.csv(here::here("Scenarios", "PatchModel_size.csv"))%>%
  filter(Year <= 2050)%>%
  group_by(Adjusted, Status, Total_Area, Year)%>%
  summarize(Biomass_est=sum(Biomass_est)/1000, 
          Biomass_lo=sum(Biomass_lo)/1000, 
          Biomass_hi=sum(Biomass_hi)/1000,
          Catch_est=sum(Catch_est)/1000,
          Catch_lo=sum(Catch_lo)/1000, 
          Catch_hi=sum(Catch_hi)/1000, 
           PV_est=sum(PV_est)/1000000,
          PV_lo=sum(PV_lo)/1000000, 
          PV_hi=sum(PV_hi)/1000000)

```


#Reserves at 5% of total area with different implemntation dates; I think this is what COBI wants to see 

```{r}
plot1<- res%>%
  filter(Adjusted=="MT", Total_Area=="5%")
plot1$Status<- as.factor(plot1$Status)

B<-ggplot(plot1, aes(x=Year, y=Biomass_est, group=Status, color=Status))+
  geom_line(size=1.5)+
  labs(subtitle= "Biomass", y="1000s MT")+
  theme_classic(base_size = 24)

C<-ggplot(plot1, aes(x=Year, y=Catch_est, group=Status, color=Status))+
  geom_line(size=1.5)+
  labs(subtitle= "Catch", y="1000s MT")+
  theme_classic(base_size = 24)

P<-ggplot(plot1, aes(x=Year, y=PV_est, group=Status, color=Status))+
  geom_line(size=1.5)+
  labs(subtitle= "Profit", y= "MUSD")+
  theme_classic(base_size = 24)


Line1<-ggarrange(B, C, P, nrow=3, common.legend = TRUE, legend="bottom")
ggsave("Line1.jpg", width=10, height=12, dpi=300)
```


#Same plot with different reserve sizes 
```{r}
plot2<- res%>%
  filter(Adjusted=="MT", Status =="2015", Total_Area=="40%")

B<-ggplot(plot2, aes(x=Year, y=Biomass_est, group=Total_Area, color=Total_Area))+
  geom_line(size=1.5)+
  labs(title= "Marine Reserves Sizes", subtitle= "Biomass", y="1000s MT")+
  theme_classic(base_size = 24)

C<-ggplot(plot2, aes(x=Year, y=Catch_est, group=Total_Area, color=Total_Area))+
  geom_line(size=1.5)+
  labs(subtitle= "Catch", y="1000s MT")+
  theme_classic(base_size = 24)

P<-ggplot(plot2, aes(x=Year, y=PV_est, group=Total_Area, color=Total_Area))+
  geom_line(size=1.5)+
  labs(subtitle= "Profit", y= "MUSD")+
  theme_classic(base_size = 24)


Line2<-ggarrange(B, C, P, nrow=3, common.legend = TRUE, legend="bottom")
Line2
ggsave("Line2.jpg", width=10, height=12, dpi=300)
```



